package com.bnpparibas.dsibddf.fis.pvi.domain.config;

import lombok.Data;
import org.springframework.boot.context.properties.ConfigurationProperties;

import java.math.BigDecimal;
import java.util.List;
import java.util.Map;

@Data
@ConfigurationProperties(prefix = "pvi")
public class PviBusinessProperties {

    private AbatementProperties abatement;
    private List<SurtaxBracket> surtaxBrackets;
    private SuggestionProperties suggestion;

    // --------- 1. ABATTEMENT ---------
    @Data
    public static class AbatementProperties {
        /**
         * Clé = nombre d'années de détention ("0", "1", ..., "30")
         */
        private Map<String, YearAbatement> years;
    }

    @Data
    public static class YearAbatement {
        private TaxAbatement ir;
        private TaxAbatement ps;
    }

    @Data
    public static class TaxAbatement {
        private BigDecimal annualRate;          // tauxAnnuel
        private BigDecimal globalAllowanceRate; // tauxAbattementGlobal
    }

    // --------- 2. SURTAXE (texe-pvi) ---------
    @Data
    public static class SurtaxBracket {
        private BigDecimal min;
        private BigDecimal max;
        private BigDecimal plusValuePercent; // %plusValue
        private BigDecimal ratio;            // rapport (optionnel)
    }

    // --------- 3. SUGGESTIONS ---------
    @Data
    public static class SuggestionProperties {
        private int show;
        /**
         * Clé = catégorie ("general", "financier", "juridique", "fiscal")
         */
        private Map<String, List<SuggestionItem>> suggestions;
    }

    @Data
    public static class SuggestionItem {
        private String value;
        private String url;
        private Condition condition;
    }

    @Data
    public static class Condition {
        private Object part1;   // peut être String ou sous-condition (pour les "||" imbriqués)
        private String operator;
        private Object part2;
    }
}
